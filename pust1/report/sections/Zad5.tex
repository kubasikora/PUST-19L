\chapter{Dobieranie nastawów regulatorów PID i DMC}
\label{zad5}

\section{Strojenie regulatora PID}
\label{zad5_PID_wykresy}

Do naszej metody eksperymentalnej włączyliśmy metodę Zieglera-Nicholsa. Taki zabieg miał na celu znalezienie dobrego punktu początkowego od którego mogliśmy zacząć dobierać parametry metodą eksperymentalną.

Dobierając nastawy według metody Zieglera-Nicholsa, stosowaliśmy wzory do obliczenia parametrów regulatora PID: 
\begin{center}
$K_{r}=0,6K_{k}, T_{i}=0,5T_{k}, T_{d}=0,12T_{k}$
\\gdzie $K_{k}$ - wzmocnienie krytyczne, $T_{k}$ - okres oscylacji
\end{center}
Na początku doprowadziliśmy układ do granicy stabilności, czyli momentu, w którym zaczęły pojawiać się niegasnące oscylacje. Zrealizowaliśmy to zwiększając współczynnik wzmocnienia $K_{r}$ przy wyłączonych członach całkującym i różniczkującym, w tym momencie regulator stał się regulatorem typu P. Gdy zaobserwowaliśmy niegasnące oscylacje wyznaczyliśmy wzmocnienie krytyczne $K_{k}$, które było równe aktualnemu wzmocnieniu regulatora $K_{r}$ oraz zmierzyliśmy okres oscylacji drgań krytycznych $T_{k}$ ($K_{k} = 1,6 \hspace{0.3 cm} T_{k}=19$). Wiemy że okres próbkowania wynosi $0,5$ s, a okres oscylacji odpowiada $38$ próbką, stąd możemy łatwo wyliczyć okres drgań krytycznych $T_{k}=19$ s. Ustalone wartości $K_{r}$ i $T_{k}$ podstawiliśmy do wzorów przedstawionych wyżej, aby wyliczyć parametry $K_{r}, T_{i}, T_{d}$. 
\newpage
Przebieg wyznaczania parametrów dla regulatora PID:
~\\\\
\indent 1. Pojawiają się niegasnące oscylacje, w tym momencie możemy określić wartość $T_{k}=19$ i $K_{k}=1.6$ s
\begin{figure}[h]
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0,xmax=500,ymin=3.9, ymax=4.4,
    xlabel={$k$},
    ylabel={$y[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_setpoint_exampleK_1.6_Ti_1000000000_Td_0.csv};
    \addplot[red, semithick] file{../data/zad5_PID_output_exampleK_1.6_Ti_1000000000_Td_0.csv};
    \addlegendentry{$y^{zad}[k]$},
    \addlegendentry{$y[k]$},
    \addlegendimage{no markers, blue}
	\addlegendimage{no markers, red}
    \end{axis}
    \end{tikzpicture}
    \caption{Odpowiedź skokowa układu regulacji}
    \label{zad5_niegasnące_oscylacje}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0,xmax=500,ymin=0.45, ymax=0.75,
    xlabel={$k$},
    ylabel={$u[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_input_exampleK_1.6_Ti_1000000000_Td_0.csv};
    \legend{$u[k]$}
    \end{axis}
    \end{tikzpicture}
    \caption{Sygnał sterujący u}
    \label{zad2_stat_wykres}
\end{figure}
\FloatBarrier

\indent 2. Poniższe charakterystyki otrzymałem po podstawieniu wartości $K_{k}$ i $T_{k}$ do wzorów na $K_{r}, T_{i}, T_{d}$
\begin{figure}[h]
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0,xmax=500,ymin=3.9, ymax=4.4,
    xlabel={$k$},
    ylabel={$y[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_setpoint_exampleK_0.72_Ti_9.5_Td_2.28.csv};
    \addplot[red, semithick] file{../data/zad5_PID_output_exampleK_0.72_Ti_9.5_Td_2.28.csv};
    \addlegendentry{$y^{zad}[k]$},
    \addlegendentry{$y[k]$},
    \addlegendimage{no markers, blue}
	\addlegendimage{no markers, red}
    \end{axis}
    \end{tikzpicture}
    \caption{Odpowiedź skokowa układu regulacji}
    \label{zad5_niegasnące_oscylacje}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0.0,ymin=0.45, xmax= 500,
    xlabel={$k$},
    ylabel={$u[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_input_exampleK_0.72_Ti_9.5_Td_2.28.csv};
    \legend{$u[k]$}
    \end{axis}
    \end{tikzpicture}
    \caption{Sygnał sterujący u}
    \label{zad2_stat_wykres}
\end{figure}
\FloatBarrier

Wartości liczbowe parametrów:
\begin{center}
$K_{r}=0,72 T_{i}=9,5 T_{d}=2,28$
\end{center}
~\\wskaźnik jakości regulacji:
\begin{center}
$E=1,6185$
\end{center}
~\\\\Widzimy, że regulator dostrojony za pomocą metody Zieglera-Nicholsa zachowuje się co najwyżej poprawnie (w stosunkowo krótkim czasie osiąga wartość zadaną). Przebieg sygnału sterującego prezentuje się całkiem dobrze. Jednak nasz zespół miał uwagi do odpowiedzi regulatora na skok wartości zadanej. W takiej sytuacji sygnał na okres około 50 próbek bardzo mocno przekracza wielkość zadaną. Taka sytuacja może być nie do zaakceptowania, wszędzie tam gdzie sterowanie musi być bardzo precyzyjne, a zmiany wartości zadanej są częste i charakteryzują się dużymi skokami. Szukając lepszych nastawów przechodzimy do metody eksperymentalnej w której to jakość regulacji będziemy oceniali jakościowo i ilościowo wg. wzoru:
\begin{center}
$E=\sum_{k-1}^{K_{konc}}(y^{zad}(k)-y(k))^{2}$.
\end{center}

~\\
\indent 3. Zmiany zaczęliśmy od członu proporcjonalnego. Postanowiliśmy go zmniejszyć, co spowodowało wygładzenie odpowiedzi skokowej. Pas ponad wartością zadaną stał się szerszy, ale przebieg sygnału był zdecydowanie łagodniejszy (nie było szpiczastych pików i zniknęły małe drgania). Nastąpiła zdecydowana zmiana przebiegu sygnału sterującego. Był on nadal ucinany przez ograniczenie, ale jego zmiany stały się bardziej regularne (łagodnie opadł do poziomu 0,6 co zapewnia utrzymanie wartości zadanej).

\begin{center}
Wartość wskaźnika regulacji wynosi $E=2,9694$.
\end{center}
\begin{figure}[h]
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0,xmax=500,ymin=3.9, ymax=4.4,
    xlabel={$k$},
    ylabel={$y[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_setpoint_exampleK_0.45_Ti_9.5_Td_2.28.csv};
    \addplot[red, semithick] file{../data/zad5_PID_output_exampleK_0.45_Ti_9.5_Td_2.28.csv};
    \addlegendentry{$y^{zad}[k]$},
    \addlegendentry{$y[k]$},
    \addlegendimage{no markers, blue}
	\addlegendimage{no markers, red}
    \end{axis}
    \end{tikzpicture}
    \caption{Odpowiedź skokowa układu regulacji}
    \label{zad5_niegasnące_oscylacje}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0.0,ymin=0.45, xmax= 500,
    xlabel={$k$},
    ylabel={$u[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_input_exampleK_0.45_Ti_9.5_Td_2.28.csv};
    \legend{$u[k]$}
    \end{axis}
    \end{tikzpicture}
    \caption{Sygnał sterujący u}
    \label{zad2_stat_wykres}
\end{figure}
\FloatBarrier

\indent 4. W następnym kroku zmniejszyliśmy jeszcze bardziej wartość członu proporcjonalnego. W ten sposób chcieliśmy zmniejszyć wartość uchybu ustalonego. Niestety nie osiągneliśmy zadanego celu, dodatkowo zwiększył nam się czas regulacji (jest to zachowanie zgodne z matematycznymi wzorami dla regulatora PID), dlatego podjęliśmy decyzję o zmianach wartościami dla innych członów. 
\begin{center}
Wartość wskaźnika regulacji wynosi $E=5,7761$.
\end{center}
\begin{figure}[h]
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0,xmax=500,ymin=3.9, ymax=4.4,
    xlabel={$k$},
    ylabel={$y[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_setpoint_exampleK_0.225_Ti_9.5_Td_2.28.csv};
    \addplot[red, semithick] file{../data/zad5_PID_output_exampleK_0.225_Ti_9.5_Td_2.28.csv};
    \addlegendentry{$y^{zad}[k]$},
    \addlegendentry{$y[k]$},
    \addlegendimage{no markers, blue}
	\addlegendimage{no markers, red}
    \end{axis}
    \end{tikzpicture}
    \caption{Odpowiedź skokowa układu regulacji}
    \label{zad5_niegasnące_oscylacje}
\end{figure}

\begin{figure}[h]
	\label{zad5_sterowanie_ustalenie_k}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0.0,ymin=0.45, xmax= 500,
    xlabel={$k$},
    ylabel={$u[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_input_exampleK_0.225_Ti_9.5_Td_2.28.csv};
    \legend{$u[k]$}
    \end{axis}
    \end{tikzpicture}
    \caption{Sygnał sterujący u}
\end{figure}
\FloatBarrier


\indent 5. Zmniejszenie wartości $T_{i}$ powoduj wzrost znaczenie członu całkującego. Najprościej mówiąc dodaje on stale sygnał uchybu. Gdy uchyb jest powyżej 0 wymusza on na sygnale sterującym coraz większą wartość. Efektem jego działania jest sprowadzenie uchybu do zera. Jego działanie możemy zaobserwować po przez szybszy czas regulacji (wartość z regulatora szybciej zbiega do wartości zadanej), a przy nie zerowym uchybie sterowanie również osiąga większe wartości (widzimy to porównując wykresy \ref{zad5_sterowanie_ustalenie_k} i \ref{zad5_sterowanie_ustalenie_ti}).
\begin{center}
Wartość wskaźnika regulacji wynosi $E=4,1742$.
\end{center}
\begin{figure}[h]
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0,xmax=500,ymin=3.9, ymax=4.4,
    xlabel={$k$},
    ylabel={$y[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_setpoint_exampleK_0.19152_Ti_4.9007_Td_0.1.csv};
    \addplot[red, semithick] file{../data/zad5_PID_output_exampleK_0.19152_Ti_4.9007_Td_0.1.csv};
    \addlegendentry{$y^{zad}[k]$},
    \addlegendentry{$y[k]$},
    \addlegendimage{no markers, blue}
	\addlegendimage{no markers, red}
    \end{axis}
    \end{tikzpicture}
    \caption{Odpowiedź skokowa układu regulacji}
    \label{zad5_niegasnące_oscylacje}
\end{figure}

\begin{figure}[h]
    \label{zad5_sterowanie_ustalenie_ti}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0.0,ymin=0.45, xmax= 500,
    xlabel={$k$},
    ylabel={$u[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_input_exampleK_0.19152_Ti_4.9007_Td_0.1.csv};
    \legend{$u[k]$}
    \end{axis}
    \end{tikzpicture}
    \caption{Sygnał sterujący u}
\end{figure}
\FloatBarrier

\indent 6. W ostatnim kroku kluczowym etapem było obniżenie wartości członu różniczkującego. Jego działanie jest tym mocniejsze im szybciej zmienia się uchyb. Jego 10-krotne zmniejszenie spowodowało zanik przeregulowania, a także skróciło czas regulacji. Są to wielkości, którymi możemy manipulować za pomocą wartości $T_{d}$. Zmieniając kosmetycznie wartości K i $T_{i}$ uzyskaliśmy najmnniejszą wartość wskaźnika regulacji równą $E=1,016$. W tym przypadku przebieg sygnałów odpowiedzi regulatora i sterującego jest także najlepszy. 
\begin{figure}[h]
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0,xmax=500,ymin=3.9, ymax=4.4,
    xlabel={$k$},
    ylabel={$y[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_setpoint_exampleK_0.171_Ti_5.2007_Td_0.090366.csv};
    \addplot[red, semithick] file{../data/zad5_PID_output_exampleK_0.171_Ti_5.2007_Td_0.090366.csv};
    \addlegendentry{$y^{zad}[k]$},
    \addlegendentry{$y[k]$},
    \addlegendimage{no markers, blue}
	\addlegendimage{no markers, red}
    \end{axis}
    \end{tikzpicture}
    \caption{Odpowiedź skokowa układu regulacji}
    \label{zad5_niegasnące_oscylacje}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{tikzpicture}
    \begin{axis}[
    width=0.98\textwidth,
    xmin=0.0,ymin=0.45, xmax= 500,
    xlabel={$k$},
    ylabel={$u[k]$},
    %xtick={0.3, 0.4, 0.5, 0.6, 0.7},
    %ytick={3.5, 3.75, 4, 4.25, 4.5},
    legend pos=south east,
    y tick label style={/pgf/number format/1000 sep=},
    ]
    \addplot[blue, semithick] file{../data/zad5_PID_input_exampleK_0.171_Ti_5.2007_Td_0.090366.csv};
    \legend{$u[k]$}
    \end{axis}
    \end{tikzpicture}
    \caption{Sygnał sterujący u}
    \label{zad2_stat_wykres}
\end{figure}
\FloatBarrier